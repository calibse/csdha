#! /bin/sh

set -e

max_retries=10
delay=5
retries=0

while [ $retries -lt $max_retries ] 
do
	if php artisan migrate:status > /dev/null 2>&1 && \
		! php artisan migrate:status | grep -q "No" 

	then
		break
	else
		retries=$((retries+1))
		echo "Database not ready. Retry $retries/$max_retries in $delay seconds..."
		sleep $delay
	fi
done

if [ $retries -ge $max_retries ]
then
	echo "Database not ready after $max_retries retries. Exiting."
	exit 1
fi

